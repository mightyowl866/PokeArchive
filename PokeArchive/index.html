<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PokéArchive</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>PokéArchive</h1>
<div class="tabs">
  <button class="tab-button active" data-tab="search">Search</button>
  <button class="tab-button" data-tab="decks">Decks</button>
  <button class="tab-button" data-tab="collection">Collection</button>
  <button class="tab-button" data-tab="settings">Settings</button>
</div>

<div id="settings" class="tab-content">
  <h2>Settings</h2>
  <form id="settingsForm">
    <label for="apiKey">API Key:</label>
    <input type="text" id="apiKey" name="apiKey" placeholder="Enter your API key" required>
    <button type="submit">Save Settings</button>
  </form>
  <div id="settingsMessage" style="margin-top: 10px; color: green;"></div>
</div>

  <div id="search" class="tab-content active">
    <form id="cardForm">
      <label for="cardName">Enter Card Name:</label>
      <input type="text" id="cardName" name="cardName" required>
      <button type="submit">Search</button>
    </form>
    
    <div id="result"></div>
  </div>

  <div id="decks" class="tab-content">
    <h2>Your Decks</h2>
    <form id="createDeckForm">
      <label for="deckName">Create a New Deck:</label>
      <input type="text" id="deckName" name="deckName" placeholder="Enter deck name" required>
      <button type="submit">Create Deck</button>
    </form>
    <div id="deckList"></div>
    <div id="selectedDeck" style="display: none;">
      <h3 id="selectedDeckName"></h3>
      <button id="backToDecks">Back to Decks</button>
      <div id="selectedDeckContent"></div>
    </div>
  </div>

  <div id="collection" class="tab-content">
    <h2>Your Collection</h2>
    <input type="text" id="collectionSearch" placeholder="Search your collection...">
    <button id="saveCollection">Save Collection</button>
      <div id="collectionControls" style="text-align:center; margin-bottom:15px;">
    
    <select id="collectionSort">
      <option value="name-asc">Sort: Name (A-Z)</option>
      <option value="name-desc">Sort: Name (Z-A)</option>
      <option value="count-desc">Sort: Most Copies</option>
      <option value="count-asc">Sort: Fewest Copies</option>
    </select>
    <select id="collectionFilter">
      <option value="">All Sets</option>
      <!-- JS will populate unique set names here -->
    </select>
    <select id="collectionTypeFilter">
      <option value="">All Types</option>
      <!-- JS will populate unique types -->
    </select>
    <select id="collectionRarityFilter">
      <option value="">All Rarities</option>
      <!-- JS will populate unique rarities -->
    </select>
    <select id="collectionHpFilter">
      <option value="">All HP</option>
      <option value="0-60">0–60</option>
      <option value="61-100">61–100</option>
      <option value="101-">101+</option>
    </select>
    <button id="massEditBtn" style="margin-left:10px;">Mass Edit</button>
  </div>
    <div id="collectionContent"></div>
  </div>

  <script src="./src/collection.js"></script>
  <script src="./src/decks.js"></script>


  
<script>
document.querySelectorAll('.tab-button').forEach(button => {
  button.addEventListener('click', () => {
    // Remove "active" from all tab buttons
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');

    // Fade out all tab contents
    document.querySelectorAll('.tab-content.active').forEach(tab => {
      tab.classList.remove('active');
      // Wait for fade-out before hiding (optional, for smoother transition)
      setTimeout(() => { tab.style.display = 'none'; }, 400);
    });

    // Find and fade in the selected tab
    const tabId = button.getAttribute('data-tab');
    const tabContent = document.getElementById(tabId);
    if (tabContent) {
      tabContent.style.display = 'block';
      // Force reflow to restart transition
      void tabContent.offsetWidth;
      tabContent.classList.add('active');
    }

    // If entering the collection tab, render the collection
    if (tabId === 'collection') {
      renderCards(collection, 'collectionContent', true);
    } else {
      // If leaving the collection tab, clear only the cards (not the search bar)
      const collectionContent = document.getElementById('collectionContent');
      if (collectionContent) collectionContent.innerHTML = '';
    }
  });
});

  // On page load: load API key and show the correct tab
  document.addEventListener('DOMContentLoaded', () => {
    // Load saved API key into the settings form
    const savedApiKey = localStorage.getItem('apiKey');
    if (savedApiKey) {
      document.getElementById('apiKey').value = savedApiKey;
    }
    // Show the first tab by default
    document.querySelector('.tab-button.active')?.click();
  });

  // Save settings (API key)
  document.getElementById('settingsForm').addEventListener('submit', (event) => {
    event.preventDefault();
    const apiKey = document.getElementById('apiKey').value.trim();
    if (apiKey) {
      localStorage.setItem('apiKey', apiKey);
      document.getElementById('settingsMessage').textContent = 'Settings saved successfully!';
      setTimeout(() => {
        document.getElementById('settingsMessage').textContent = '';
      }, 3000);
    }
  });
</script>
<div id="loadingSpinner">
  <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png" alt="Loading..." class="pokeball-spinner">
</div>
</body>
</html>