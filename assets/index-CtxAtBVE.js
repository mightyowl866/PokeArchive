(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function a(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=a(t);fetch(t.href,i)}})();const m=JSON.parse(localStorage.getItem("collection"))||[];function k(){return JSON.parse(localStorage.getItem("decks"))||{}}function L(e){localStorage.setItem("decks",JSON.stringify(e))}function N(){return localStorage.getItem("apiKey")}document.getElementById("cardForm").addEventListener("submit",async e=>{e.preventDefault();const o=N(),a=document.getElementById("cardName").value,s=document.getElementById("loadingSpinner"),t=document.getElementById("result");let i=document.getElementById("apiKeyAlert");if(o)i&&i.remove();else if(!i){i=document.createElement("div"),i.id="apiKeyAlert",i.style.background="#ffdddd",i.style.color="#a00",i.style.border="1px solid #a00",i.style.padding="8px 12px",i.style.margin="10px 0",i.style.borderRadius="4px",i.style.fontWeight="bold",i.textContent="No API key found. You can use the app, but you may be rate-limited or blocked. Please set an API key in Settings for best results.";const n=document.getElementById("collectionSearch");n&&n.parentElement&&n.parentElement.insertBefore(i,n.nextSibling)}t.classList.add("fade-out"),setTimeout(()=>{s.classList.add("show"),t.innerHTML=""},400);try{let n={};o&&(n["X-Api-Key"]=o);const l=await fetch(`https://api.pokemontcg.io/v2/cards?q=name:${encodeURIComponent(a)}`,{headers:n});if(!l.ok)throw new Error("Card not found or an error occurred.");const y=(await l.json()).data;s.classList.remove("show"),setTimeout(()=>{y.length===0?t.innerHTML=`<p>No cards found with the name "${a}".</p>`:F(y,"result",!1),t.classList.remove("fade-out"),t.classList.add("fade-in"),setTimeout(()=>t.classList.remove("fade-in"),400)},200)}catch(n){s.classList.remove("show"),setTimeout(()=>{t.innerHTML=`<p>Error: ${n.message}</p>`,t.classList.remove("fade-out"),t.classList.add("fade-in"),setTimeout(()=>t.classList.remove("fade-in"),400)},200)}});function O(){const e=document.getElementById("collectionFilter");if(!e)return;const o=e.value,a=Array.from(new Set(m.map(s=>s.setName).filter(Boolean))).sort();e.innerHTML='<option value="">All Sets</option>'+a.map(s=>`<option value="${s}">${s}</option>`).join(""),e.value=o}function H(){var l,d,y,p,v,E;const e=((l=document.getElementById("collectionSearch"))==null?void 0:l.value.trim().toLowerCase())||"",o=((d=document.getElementById("collectionSort"))==null?void 0:d.value)||"name-asc",a=((y=document.getElementById("collectionFilter"))==null?void 0:y.value)||"",s=((p=document.getElementById("collectionTypeFilter"))==null?void 0:p.value)||"",t=((v=document.getElementById("collectionRarityFilter"))==null?void 0:v.value)||"",i=((E=document.getElementById("collectionHpFilter"))==null?void 0:E.value)||"";let n=m.filter(r=>(!e||r.name.toLowerCase().includes(e)||r.setName&&r.setName.toLowerCase().includes(e))&&(!a||r.setName===a)&&(!s||r.types&&r.types.includes(s))&&(!t||r.rarity===t)&&(!i||i==="0-60"&&Number(r.hp)<=60||i==="61-100"&&Number(r.hp)>60&&Number(r.hp)<=100||i==="101-"&&Number(r.hp)>100));switch(o){case"name-asc":n.sort((r,f)=>r.name.localeCompare(f.name));break;case"name-desc":n.sort((r,f)=>f.name.localeCompare(r.name));break;case"count-desc":n.sort((r,f)=>(f.count||1)-(r.count||1));break;case"count-asc":n.sort((r,f)=>(r.count||1)-(f.count||1));break}return n}function q(){const e=document.getElementById("collectionTypeFilter");if(e){const a=Array.from(new Set(m.flatMap(s=>s.types||[]))).sort();e.innerHTML='<option value="">All Types</option>'+a.map(s=>`<option value="${s}">${s}</option>`).join("")}const o=document.getElementById("collectionRarityFilter");if(o){const a=Array.from(new Set(m.map(s=>s.rarity).filter(Boolean))).sort();o.innerHTML='<option value="">All Rarities</option>'+a.map(s=>`<option value="${s}">${s}</option>`).join("")}}function u(){O(),q(),F(H(),"collectionContent",!0)}document.getElementById("collectionSearch").addEventListener("input",u);document.getElementById("collectionSort").addEventListener("change",u);document.getElementById("collectionFilter").addEventListener("change",u);document.getElementById("collectionTypeFilter").addEventListener("change",u);document.getElementById("collectionRarityFilter").addEventListener("change",u);document.getElementById("collectionHpFilter").addEventListener("change",u);document.getElementById("massEditBtn").addEventListener("click",()=>{b=!0,g.clear(),u()});function K(e,o,a,s,t){const i=m.find(n=>n.id===e);if(i)i.count+=1;else{const n={...t||{},id:e,name:o,image:a,setName:s,count:1};m.push(n)}localStorage.setItem("collection",JSON.stringify(m)),u()}function j(e){const o=m.find(a=>a.id===e);if(o)if(o.count>1)o.count-=1;else{const a=m.findIndex(s=>s.id===e);m.splice(a,1)}localStorage.setItem("collection",JSON.stringify(m)),u()}function P(e){const o=k();if(!e){alert("Please enter a valid deck name.");return}if(o[e]){alert("A deck with this name already exists.");return}o[e]=[],L(o),h()}function R(e,o){const a=k();if(!a[e]){alert("Deck not found.");return}const s=a[e];if(s.reduce((n,l)=>n+(l.count||1),0)>=60){alert("Deck limit reached! You cannot have more than 60 cards in a deck.");return}const i=s.find(n=>n.id===o.id);i?i.count=(i.count||1)+1:s.push({...o,count:1}),L(a),alert(`Added ${o.name} to ${e}!`),h()}function J(e,o){const a=k();if(!a[e]){alert("Deck not found.");return}const s=a[e].find(t=>t.id===o);if(s)if(s.count>1)s.count-=1;else{const t=a[e].findIndex(i=>i.id===o);a[e].splice(t,1)}L(a),h()}function T(e){const o=k();confirm(`Are you sure you want to delete the deck "${e}"?`)&&(delete o[e],L(o),h())}function h(){const e=k(),o=document.getElementById("deckList");o&&(o.innerHTML="",Object.keys(e).forEach(a=>{const s=document.createElement("div");s.classList.add("deck");const t=document.createElement("h3");t.textContent=a;const i=document.createElement("button");i.textContent="Delete Deck",i.classList.add("delete-deck"),i.addEventListener("click",()=>T(a));const n=document.createElement("div");n.classList.add("card-list"),e[a].forEach(l=>{const d=document.createElement("div");d.classList.add("deck-card"),d.innerHTML=`
        <img src="${l.image}" alt="${l.name}" class="card-image">
        <button onclick="removeFromDeck('${a}', '${l.id}')">Remove</button>
      `,n.appendChild(d)}),s.appendChild(t),s.appendChild(i),s.appendChild(n),o.appendChild(s)}))}let b=!1,g=new Set;function F(e,o,a){const s=document.getElementById(o);if(s.innerHTML="",e.forEach((t,i)=>{var l,d,y;const n=document.createElement("div");n.classList.add(a?"collection-card":"card"),a&&b?(n.style.position="relative",g.has(t.id)?n.classList.add("mass-edit-selected"):n.classList.remove("mass-edit-selected"),n.innerHTML=`
        <input type="checkbox" class="mass-edit-checkbox" data-id="${t.id}" style="position:absolute;left:8px;top:8px;z-index:2;" ${g.has(t.id)?"checked":""}>
        <img src="${t.image||((l=t.images)==null?void 0:l.large)}" alt="${t.name}" class="card-image">
        <input type="number" min="1" value="${t.count||1}" class="mass-edit-qty" data-id="${t.id}" style="width:40px;margin-top:8px;display:block;margin-left:auto;margin-right:auto;">
        <div class="card-count">x${t.count||1}</div>
      `,n.addEventListener("click",p=>{p.target.classList.contains("mass-edit-checkbox")||p.target.classList.contains("mass-edit-qty")||(g.has(t.id)?(g.delete(t.id),n.classList.remove("mass-edit-selected"),n.querySelector(".mass-edit-checkbox").checked=!1):(g.add(t.id),n.classList.add("mass-edit-selected"),n.querySelector(".mass-edit-checkbox").checked=!0))}),n.querySelector(".mass-edit-checkbox").addEventListener("change",function(p){this.checked?(g.add(t.id),n.classList.add("mass-edit-selected")):(g.delete(t.id),n.classList.remove("mass-edit-selected")),p.stopPropagation()})):a?(n.innerHTML=`
        <img src="${t.image||((y=t.images)==null?void 0:y.large)}" alt="${t.name}" class="card-image">
        ${t.count>1?`<div class="card-count">x${t.count}</div>`:'<div class="card-count">x1</div>'}
      `,n.addEventListener("click",p=>{p.stopPropagation(),A(t)})):(n.classList.add("card-flip-container"),n.style.width="180px",n.style.height="260px",n.innerHTML=`
        <div class="card-flip">
          <div class="card-front">
            <img src="${t.image||((d=t.images)==null?void 0:d.large)}" alt="${t.name}" class="card-image" style="width:100%;height:100%;">
          </div>
          <div class="card-back">
            <img src="https://images.pokemontcg.io/cardback/POKEMON_CARD_BACK.jpg" alt="Card Back" class="card-image" style="width:100%;height:100%;">
          </div>
        </div>
      `,setTimeout(()=>{n.querySelector(".card-flip").classList.add("flipped")},200+i*120),n.addEventListener("click",p=>{p.stopPropagation(),A(t)})),s.appendChild(n)}),a&&b){let t=document.getElementById("massEditControls");t||(t=document.createElement("div"),t.id="massEditControls",t.style="text-align:center;margin:16px 0;",t.innerHTML=`
        <button id="massDeleteBtn" style="margin-right:10px;">Delete Selected</button>
        <button id="massSaveBtn">Save Quantities</button>
        <button id="massEditCancelBtn" style="margin-left:10px;">Cancel</button>
      `,s.parentElement.insertBefore(t,s)),document.getElementById("massDeleteBtn").onclick=()=>{for(const i of g){const n=m.findIndex(l=>l.id===i);n!==-1&&m.splice(n,1)}g.clear(),b=!1,localStorage.setItem("collection",JSON.stringify(m)),u()},document.getElementById("massSaveBtn").onclick=()=>{document.querySelectorAll(".mass-edit-qty").forEach(i=>{const n=i.getAttribute("data-id"),l=Math.max(1,parseInt(i.value,10)||1),d=m.find(y=>y.id===n);d&&(d.count=l)}),b=!1,localStorage.setItem("collection",JSON.stringify(m)),u()},document.getElementById("massEditCancelBtn").onclick=()=>{b=!1,g.clear(),u()},s.querySelectorAll(".mass-edit-checkbox").forEach(i=>{i.addEventListener("change",function(){const n=this.getAttribute("data-id");this.checked?g.add(n):g.delete(n)})})}else{const t=document.getElementById("massEditControls");t&&t.remove()}}const W={Grass:"https://archives.bulbagarden.net/media/upload/thumb/2/2e/Grass-attack.png/38px-Grass-attack.png",Fire:"https://archives.bulbagarden.net/media/upload/thumb/a/ad/Fire-attack.png/38px-Fire-attack.png",Water:"https://archives.bulbagarden.net/media/upload/thumb/1/11/Water-attack.png/38px-Water-attack.png",Lightning:"https://archives.bulbagarden.net/media/upload/thumb/0/04/Lightning-attack.png/38px-Lightning-attack.png",Psychic:"https://archives.bulbagarden.net/media/upload/thumb/e/ef/Psychic-attack.png/38px-Psychic-attack.png",Fighting:"https://archives.bulbagarden.net/media/upload/thumb/4/48/Fighting-attack.png/38px-Fighting-attack.png",Darkness:"https://archives.bulbagarden.net/media/upload/thumb/a/ab/Darkness-attack.png/38px-Darkness-attack.png",Metal:"https://archives.bulbagarden.net/media/upload/thumb/6/64/Metal-attack.png/38px-Metal-attack.png",Fairy:"https://archives.bulbagarden.net/media/upload/thumb/4/40/Fairy-attack.png/38px-Fairy-attack.png",Dragon:"https://images.pokemontcg.io/sv1/symbol-dragon.png",Colorless:"https://archives.bulbagarden.net/media/upload/thumb/1/1d/Colorless-attack.png/30px-Colorless-attack.png"};function x(e,o=18){const a=W[e];return a?`<img src="${a}" alt="${e}" title="${e}" style="width:${o}px;height:${o}px;vertical-align:middle;">`:e}function B(e){return e?e.replace(/\[([A-Za-z]+)\]/g,(o,a)=>x(a)):""}function A(e){var E,r,f,C,S,I;document.querySelectorAll(".info-box, .info-overlay").forEach(c=>c.remove());const o=document.createElement("div");o.className="info-overlay",o.addEventListener("click",$),document.body.appendChild(o);const a=e.hp?`${e.hp}`:"—",s=e.types?e.types.join(", "):"—",t=e.subtypes?e.subtypes.join(", "):"",i=e.rarity||"";let n="";Array.isArray(e.abilities)&&e.abilities.length>0&&(n=e.abilities.map(c=>`
        <div style="margin-bottom:10px; padding-left:4px; border-left:2px solid #4bb;">
          <div><strong style="color:${c.type&&c.type.toLowerCase()==="ability"?"#e33":"#197"};">${c.type||"Ability"}: ${c.name}</strong></div>
          <div style="font-size:0.95em; color:#555;">${B(c.text||"")}</div>
        </div>
      `).join(""));let l="—";Array.isArray(e.attacks)&&e.attacks.length>0&&(l=e.attacks.map(c=>`
      <div style="margin-bottom:10px; padding-left:4px; border-left:2px solid #eee;">
        <div>
          <strong>${c.name}</strong>
          ${c.cost&&c.cost.length?c.cost.map(w=>x(w)).join(" "):""}
        </div>
        ${c.damage?`<div><strong>Damage:</strong> ${c.damage}</div>`:""}
        ${c.convertedEnergyCost!==void 0?`<div><strong>Energy Cost:</strong> ${c.convertedEnergyCost}</div>`:""}
        ${c.text?`<div style="font-size:0.95em; color:#bbb;">${B(c.text)}</div>`:""}
      </div>
    `).join(""));const d=Array.isArray(e.weaknesses)&&e.weaknesses.length>0?e.weaknesses.map(c=>`${x(c.type)} (${c.value})`).join(" "):"—",y=Array.isArray(e.resistances)&&e.resistances.length>0?e.resistances.map(c=>`${x(c.type)} (${c.value})`).join(" "):"—",p=Array.isArray(e.retreatCost)&&e.retreatCost.length>0?e.retreatCost.map(c=>x(c)).join(" "):e.retreatCost===0?"0":"—",v=document.createElement("div");v.classList.add("info-box"),v.innerHTML=`
    <div style="display: flex; gap: 32px; align-items: flex-start; min-width: 420px; max-width: 700px;">
      <div style="flex: 0 0 40%; display: flex; justify-content: center;">
        <img src="${e.image||((E=e.images)==null?void 0:E.large)}" alt="${e.name}" style="display:block; max-width:100%; max-height:380px; width:auto; height:auto; border-radius:10px; box-shadow:0 2px 16px rgba(0,0,0,0.18);">
      </div>
      <div style="flex: 1 1 60%; min-width: 200px;">
        <h3 style="margin-top:0;">${e.name}</h3>
        <p><strong>Set:</strong> ${e.setName||((r=e.set)==null?void 0:r.name)||""}</p>
        ${t?`<p><strong>Subtype:</strong> ${t}</p>`:""}
        ${i?`<p><strong>Rarity:</strong> ${i}</p>`:""}
        <p><strong>HP:</strong> ${a}</p>
        <p><strong>Type:</strong> ${s}</p>
        ${n?`<div><strong>Abilities:</strong></div>${n}`:""}
        <div><strong>Attacks:</strong></div>
        ${l}
        <p><strong>Weaknesses:</strong> ${d}</p>
        <p><strong>Resistances:</strong> ${y}</p>
        <p><strong>Retreat Cost:</strong> ${p}</p>
        <div class="info-box-buttons" style="margin-top:16px;">
          <button onclick="addToCollection('${e.id}', '${e.name}', '${e.image||((f=e.images)==null?void 0:f.large)}', '${e.setName||((C=e.set)==null?void 0:C.name)}', JSON.parse(decodeURIComponent('${encodeURIComponent(JSON.stringify(e))}')))">Add to Collection</button>
          <button onclick="showDeckSelection('${e.id}', '${e.name}', '${e.image||((S=e.images)==null?void 0:S.large)}', '${e.setName||((I=e.set)==null?void 0:I.name)}')">Add to Deck</button>
          ${m.find(c=>c.id===e.id)?`<button onclick="removeFromCollection('${e.id}')">Delete from Collection</button>`:""}
        </div>
        <button onclick="closeInfoBox()" style="margin-top:14px;">Close</button>
      </div>
    </div>
  `,document.body.appendChild(v),setTimeout(()=>{o.classList.add("show"),v.classList.add("show")},10)}function $(){document.querySelectorAll(".info-box, .info-overlay").forEach(e=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)})}function G(e,o,a,s){$();const t=k(),i=Object.keys(t);if(i.length===0){alert("No decks available. Please create a deck first.");return}document.querySelectorAll(".overlay, .deck-selection-box").forEach(d=>d.remove());const n=document.createElement("div");n.classList.add("overlay"),n.addEventListener("click",M),document.body.appendChild(n);const l=document.createElement("div");l.classList.add("deck-selection-box"),l.innerHTML=`
    <h4>Select a Deck</h4>
    ${i.map(d=>`<button onclick="addToDeck('${d}', { id: '${e}', name: '${o}', image: '${a}', setName: '${s}' })">${d}</button>`).join("")}
    <button onclick="closeDeckSelection()">Cancel</button>
  `,document.body.appendChild(l),setTimeout(()=>{n.classList.add("show"),l.classList.add("show")},10)}function M(){document.querySelectorAll(".overlay, .deck-selection-box").forEach(e=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)})}document.getElementById("saveCollection").addEventListener("click",()=>{localStorage.setItem("collection",JSON.stringify(m)),alert("Collection saved!")});const D=document.getElementById("createDeckForm");D&&D.addEventListener("submit",e=>{e.preventDefault();const o=document.getElementById("deckName").value.trim();P(o),document.getElementById("deckName").value=""});document.addEventListener("DOMContentLoaded",()=>{u(),h()});document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".tab-button").forEach(s=>s.classList.remove("active")),e.classList.add("active"),document.querySelectorAll(".tab-content.active").forEach(s=>{s.classList.remove("active"),setTimeout(()=>{s.style.display="none"},400)});const o=e.getAttribute("data-tab"),a=document.getElementById(o);if(a&&(a.style.display="block",a.offsetWidth,a.classList.add("active")),o==="collection")typeof u=="function"&&u();else if(o==="decks")typeof h=="function"&&h();else{const s=document.getElementById("collectionContent");s&&(s.innerHTML="")}})});document.addEventListener("DOMContentLoaded",()=>{var o;const e=localStorage.getItem("apiKey");e&&(document.getElementById("apiKey").value=e),(o=document.querySelector(".tab-button.active"))==null||o.click()});document.getElementById("settingsForm").addEventListener("submit",e=>{e.preventDefault();const o=document.getElementById("apiKey").value.trim();if(o){localStorage.setItem("apiKey",o),document.getElementById("settingsMessage").textContent="Settings saved successfully!";const a=document.getElementById("apiKeyAlert");a&&a.remove(),setTimeout(()=>{document.getElementById("settingsMessage").textContent=""},3e3)}});window.addToCollection=K;window.removeFromCollection=j;window.showDeckSelection=G;window.closeInfoBox=$;window.addToDeck=R;window.closeDeckSelection=M;window.removeFromDeck=J;window.deleteDeck=T;window.renderDeckList=h;
