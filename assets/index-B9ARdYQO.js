(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(t){if(t.ep)return;t.ep=!0;const a=i(t);fetch(t.href,a)}})();const m=JSON.parse(localStorage.getItem("collection"))||[];function k(){return JSON.parse(localStorage.getItem("decks"))||{}}function x(e){localStorage.setItem("decks",JSON.stringify(e))}function N(){return localStorage.getItem("apiKey")}document.getElementById("cardForm").addEventListener("submit",async e=>{e.preventDefault();const n=N(),i=document.getElementById("cardName").value,s=document.getElementById("loadingSpinner"),t=document.getElementById("result");t.classList.add("fade-out"),setTimeout(()=>{s.classList.add("show"),t.innerHTML=""},400);try{if(!n)throw new Error("No API key found. Please set it in the settings.");const a=await fetch(`https://api.pokemontcg.io/v2/cards?q=name:${encodeURIComponent(i)}`,{headers:{"X-Api-Key":n}});if(!a.ok)throw new Error("Card not found or an error occurred.");const l=(await a.json()).data;s.classList.remove("show"),setTimeout(()=>{l.length===0?t.innerHTML=`<p>No cards found with the name "${i}".</p>`:F(l,"result",!1),t.classList.remove("fade-out"),t.classList.add("fade-in"),setTimeout(()=>t.classList.remove("fade-in"),400)},200)}catch(a){s.classList.remove("show"),setTimeout(()=>{t.innerHTML=`<p>Error: ${a.message}</p>`,t.classList.remove("fade-out"),t.classList.add("fade-in"),setTimeout(()=>t.classList.remove("fade-in"),400)},200)}});function O(){const e=document.getElementById("collectionFilter");if(!e)return;const n=e.value,i=Array.from(new Set(m.map(s=>s.setName).filter(Boolean))).sort();e.innerHTML='<option value="">All Sets</option>'+i.map(s=>`<option value="${s}">${s}</option>`).join(""),e.value=n}function H(){var l,d,y,p,v,E;const e=((l=document.getElementById("collectionSearch"))==null?void 0:l.value.trim().toLowerCase())||"",n=((d=document.getElementById("collectionSort"))==null?void 0:d.value)||"name-asc",i=((y=document.getElementById("collectionFilter"))==null?void 0:y.value)||"",s=((p=document.getElementById("collectionTypeFilter"))==null?void 0:p.value)||"",t=((v=document.getElementById("collectionRarityFilter"))==null?void 0:v.value)||"",a=((E=document.getElementById("collectionHpFilter"))==null?void 0:E.value)||"";let o=m.filter(r=>(!e||r.name.toLowerCase().includes(e)||r.setName&&r.setName.toLowerCase().includes(e))&&(!i||r.setName===i)&&(!s||r.types&&r.types.includes(s))&&(!t||r.rarity===t)&&(!a||a==="0-60"&&Number(r.hp)<=60||a==="61-100"&&Number(r.hp)>60&&Number(r.hp)<=100||a==="101-"&&Number(r.hp)>100));switch(n){case"name-asc":o.sort((r,f)=>r.name.localeCompare(f.name));break;case"name-desc":o.sort((r,f)=>f.name.localeCompare(r.name));break;case"count-desc":o.sort((r,f)=>(f.count||1)-(r.count||1));break;case"count-asc":o.sort((r,f)=>(r.count||1)-(f.count||1));break}return o}function q(){const e=document.getElementById("collectionTypeFilter");if(e){const i=Array.from(new Set(m.flatMap(s=>s.types||[]))).sort();e.innerHTML='<option value="">All Types</option>'+i.map(s=>`<option value="${s}">${s}</option>`).join("")}const n=document.getElementById("collectionRarityFilter");if(n){const i=Array.from(new Set(m.map(s=>s.rarity).filter(Boolean))).sort();n.innerHTML='<option value="">All Rarities</option>'+i.map(s=>`<option value="${s}">${s}</option>`).join("")}}function u(){O(),q(),F(H(),"collectionContent",!0)}document.getElementById("collectionSearch").addEventListener("input",u);document.getElementById("collectionSort").addEventListener("change",u);document.getElementById("collectionFilter").addEventListener("change",u);document.getElementById("collectionTypeFilter").addEventListener("change",u);document.getElementById("collectionRarityFilter").addEventListener("change",u);document.getElementById("collectionHpFilter").addEventListener("change",u);document.getElementById("massEditBtn").addEventListener("click",()=>{b=!0,g.clear(),u()});function j(e,n,i,s,t){const a=m.find(o=>o.id===e);if(a)a.count+=1;else{const o={...t||{},id:e,name:n,image:i,setName:s,count:1};m.push(o)}localStorage.setItem("collection",JSON.stringify(m)),u()}function P(e){const n=m.find(i=>i.id===e);if(n)if(n.count>1)n.count-=1;else{const i=m.findIndex(s=>s.id===e);m.splice(i,1)}localStorage.setItem("collection",JSON.stringify(m)),u()}function R(e){const n=k();if(!e){alert("Please enter a valid deck name.");return}if(n[e]){alert("A deck with this name already exists.");return}n[e]=[],x(n),h()}function K(e,n){const i=k();if(!i[e]){alert("Deck not found.");return}const s=i[e];if(s.reduce((o,l)=>o+(l.count||1),0)>=60){alert("Deck limit reached! You cannot have more than 60 cards in a deck.");return}const a=s.find(o=>o.id===n.id);a?a.count=(a.count||1)+1:s.push({...n,count:1}),x(i),alert(`Added ${n.name} to ${e}!`),h()}function J(e,n){const i=k();if(!i[e]){alert("Deck not found.");return}const s=i[e].find(t=>t.id===n);if(s)if(s.count>1)s.count-=1;else{const t=i[e].findIndex(a=>a.id===n);i[e].splice(t,1)}x(i),h()}function T(e){const n=k();confirm(`Are you sure you want to delete the deck "${e}"?`)&&(delete n[e],x(n),h())}function h(){const e=k(),n=document.getElementById("deckList");n&&(n.innerHTML="",Object.keys(e).forEach(i=>{const s=document.createElement("div");s.classList.add("deck");const t=document.createElement("h3");t.textContent=i;const a=document.createElement("button");a.textContent="Delete Deck",a.classList.add("delete-deck"),a.addEventListener("click",()=>T(i));const o=document.createElement("div");o.classList.add("card-list"),e[i].forEach(l=>{const d=document.createElement("div");d.classList.add("deck-card"),d.innerHTML=`
        <img src="${l.image}" alt="${l.name}" class="card-image">
        <button onclick="removeFromDeck('${i}', '${l.id}')">Remove</button>
      `,o.appendChild(d)}),s.appendChild(t),s.appendChild(a),s.appendChild(o),n.appendChild(s)}))}let b=!1,g=new Set;function F(e,n,i){const s=document.getElementById(n);if(s.innerHTML="",e.forEach((t,a)=>{var l,d,y;const o=document.createElement("div");o.classList.add(i?"collection-card":"card"),i&&b?(o.style.position="relative",g.has(t.id)?o.classList.add("mass-edit-selected"):o.classList.remove("mass-edit-selected"),o.innerHTML=`
        <input type="checkbox" class="mass-edit-checkbox" data-id="${t.id}" style="position:absolute;left:8px;top:8px;z-index:2;" ${g.has(t.id)?"checked":""}>
        <img src="${t.image||((l=t.images)==null?void 0:l.large)}" alt="${t.name}" class="card-image">
        <input type="number" min="1" value="${t.count||1}" class="mass-edit-qty" data-id="${t.id}" style="width:40px;margin-top:8px;display:block;margin-left:auto;margin-right:auto;">
        <div class="card-count">x${t.count||1}</div>
      `,o.addEventListener("click",p=>{p.target.classList.contains("mass-edit-checkbox")||p.target.classList.contains("mass-edit-qty")||(g.has(t.id)?(g.delete(t.id),o.classList.remove("mass-edit-selected"),o.querySelector(".mass-edit-checkbox").checked=!1):(g.add(t.id),o.classList.add("mass-edit-selected"),o.querySelector(".mass-edit-checkbox").checked=!0))}),o.querySelector(".mass-edit-checkbox").addEventListener("change",function(p){this.checked?(g.add(t.id),o.classList.add("mass-edit-selected")):(g.delete(t.id),o.classList.remove("mass-edit-selected")),p.stopPropagation()})):i?(o.innerHTML=`
        <img src="${t.image||((y=t.images)==null?void 0:y.large)}" alt="${t.name}" class="card-image">
        ${t.count>1?`<div class="card-count">x${t.count}</div>`:'<div class="card-count">x1</div>'}
      `,o.addEventListener("click",p=>{p.stopPropagation(),D(t)})):(o.classList.add("card-flip-container"),o.style.width="180px",o.style.height="260px",o.innerHTML=`
        <div class="card-flip">
          <div class="card-front">
            <img src="${t.image||((d=t.images)==null?void 0:d.large)}" alt="${t.name}" class="card-image" style="width:100%;height:100%;">
          </div>
          <div class="card-back">
            <img src="https://images.pokemontcg.io/cardback/POKEMON_CARD_BACK.jpg" alt="Card Back" class="card-image" style="width:100%;height:100%;">
          </div>
        </div>
      `,setTimeout(()=>{o.querySelector(".card-flip").classList.add("flipped")},200+a*120),o.addEventListener("click",p=>{p.stopPropagation(),D(t)})),s.appendChild(o)}),i&&b){let t=document.getElementById("massEditControls");t||(t=document.createElement("div"),t.id="massEditControls",t.style="text-align:center;margin:16px 0;",t.innerHTML=`
        <button id="massDeleteBtn" style="margin-right:10px;">Delete Selected</button>
        <button id="massSaveBtn">Save Quantities</button>
        <button id="massEditCancelBtn" style="margin-left:10px;">Cancel</button>
      `,s.parentElement.insertBefore(t,s)),document.getElementById("massDeleteBtn").onclick=()=>{for(const a of g){const o=m.findIndex(l=>l.id===a);o!==-1&&m.splice(o,1)}g.clear(),b=!1,localStorage.setItem("collection",JSON.stringify(m)),u()},document.getElementById("massSaveBtn").onclick=()=>{document.querySelectorAll(".mass-edit-qty").forEach(a=>{const o=a.getAttribute("data-id"),l=Math.max(1,parseInt(a.value,10)||1),d=m.find(y=>y.id===o);d&&(d.count=l)}),b=!1,localStorage.setItem("collection",JSON.stringify(m)),u()},document.getElementById("massEditCancelBtn").onclick=()=>{b=!1,g.clear(),u()},s.querySelectorAll(".mass-edit-checkbox").forEach(a=>{a.addEventListener("change",function(){const o=this.getAttribute("data-id");this.checked?g.add(o):g.delete(o)})})}else{const t=document.getElementById("massEditControls");t&&t.remove()}}const W={Grass:"https://archives.bulbagarden.net/media/upload/thumb/2/2e/Grass-attack.png/38px-Grass-attack.png",Fire:"https://archives.bulbagarden.net/media/upload/thumb/a/ad/Fire-attack.png/38px-Fire-attack.png",Water:"https://archives.bulbagarden.net/media/upload/thumb/1/11/Water-attack.png/38px-Water-attack.png",Lightning:"https://archives.bulbagarden.net/media/upload/thumb/0/04/Lightning-attack.png/38px-Lightning-attack.png",Psychic:"https://archives.bulbagarden.net/media/upload/thumb/e/ef/Psychic-attack.png/38px-Psychic-attack.png",Fighting:"https://archives.bulbagarden.net/media/upload/thumb/4/48/Fighting-attack.png/38px-Fighting-attack.png",Darkness:"https://archives.bulbagarden.net/media/upload/thumb/a/ab/Darkness-attack.png/38px-Darkness-attack.png",Metal:"https://archives.bulbagarden.net/media/upload/thumb/6/64/Metal-attack.png/38px-Metal-attack.png",Fairy:"https://archives.bulbagarden.net/media/upload/thumb/4/40/Fairy-attack.png/38px-Fairy-attack.png",Dragon:"https://images.pokemontcg.io/sv1/symbol-dragon.png",Colorless:"https://archives.bulbagarden.net/media/upload/thumb/1/1d/Colorless-attack.png/30px-Colorless-attack.png"};function L(e,n=18){const i=W[e];return i?`<img src="${i}" alt="${e}" title="${e}" style="width:${n}px;height:${n}px;vertical-align:middle;">`:e}function B(e){return e?e.replace(/\[([A-Za-z]+)\]/g,(n,i)=>L(i)):""}function D(e){var E,r,f,C,S,I;document.querySelectorAll(".info-box, .info-overlay").forEach(c=>c.remove());const n=document.createElement("div");n.className="info-overlay",n.addEventListener("click",$),document.body.appendChild(n);const i=e.hp?`${e.hp}`:"—",s=e.types?e.types.join(", "):"—",t=e.subtypes?e.subtypes.join(", "):"",a=e.rarity||"";let o="";Array.isArray(e.abilities)&&e.abilities.length>0&&(o=e.abilities.map(c=>`
        <div style="margin-bottom:10px; padding-left:4px; border-left:2px solid #4bb;">
          <div><strong style="color:${c.type&&c.type.toLowerCase()==="ability"?"#e33":"#197"};">${c.type||"Ability"}: ${c.name}</strong></div>
          <div style="font-size:0.95em; color:#555;">${B(c.text||"")}</div>
        </div>
      `).join(""));let l="—";Array.isArray(e.attacks)&&e.attacks.length>0&&(l=e.attacks.map(c=>`
      <div style="margin-bottom:10px; padding-left:4px; border-left:2px solid #eee;">
        <div>
          <strong>${c.name}</strong>
          ${c.cost&&c.cost.length?c.cost.map(w=>L(w)).join(" "):""}
        </div>
        ${c.damage?`<div><strong>Damage:</strong> ${c.damage}</div>`:""}
        ${c.convertedEnergyCost!==void 0?`<div><strong>Energy Cost:</strong> ${c.convertedEnergyCost}</div>`:""}
        ${c.text?`<div style="font-size:0.95em; color:#bbb;">${B(c.text)}</div>`:""}
      </div>
    `).join(""));const d=Array.isArray(e.weaknesses)&&e.weaknesses.length>0?e.weaknesses.map(c=>`${L(c.type)} (${c.value})`).join(" "):"—",y=Array.isArray(e.resistances)&&e.resistances.length>0?e.resistances.map(c=>`${L(c.type)} (${c.value})`).join(" "):"—",p=Array.isArray(e.retreatCost)&&e.retreatCost.length>0?e.retreatCost.map(c=>L(c)).join(" "):e.retreatCost===0?"0":"—",v=document.createElement("div");v.classList.add("info-box"),v.innerHTML=`
    <div style="display: flex; gap: 32px; align-items: flex-start; min-width: 420px; max-width: 700px;">
      <div style="flex: 0 0 40%; display: flex; justify-content: center;">
        <img src="${e.image||((E=e.images)==null?void 0:E.large)}" alt="${e.name}" style="display:block; max-width:100%; max-height:380px; width:auto; height:auto; border-radius:10px; box-shadow:0 2px 16px rgba(0,0,0,0.18);">
      </div>
      <div style="flex: 1 1 60%; min-width: 200px;">
        <h3 style="margin-top:0;">${e.name}</h3>
        <p><strong>Set:</strong> ${e.setName||((r=e.set)==null?void 0:r.name)||""}</p>
        ${t?`<p><strong>Subtype:</strong> ${t}</p>`:""}
        ${a?`<p><strong>Rarity:</strong> ${a}</p>`:""}
        <p><strong>HP:</strong> ${i}</p>
        <p><strong>Type:</strong> ${s}</p>
        ${o?`<div><strong>Abilities:</strong></div>${o}`:""}
        <div><strong>Attacks:</strong></div>
        ${l}
        <p><strong>Weaknesses:</strong> ${d}</p>
        <p><strong>Resistances:</strong> ${y}</p>
        <p><strong>Retreat Cost:</strong> ${p}</p>
        <div class="info-box-buttons" style="margin-top:16px;">
          <button onclick="addToCollection('${e.id}', '${e.name}', '${e.image||((f=e.images)==null?void 0:f.large)}', '${e.setName||((C=e.set)==null?void 0:C.name)}', JSON.parse(decodeURIComponent('${encodeURIComponent(JSON.stringify(e))}')))">Add to Collection</button>
          <button onclick="showDeckSelection('${e.id}', '${e.name}', '${e.image||((S=e.images)==null?void 0:S.large)}', '${e.setName||((I=e.set)==null?void 0:I.name)}')">Add to Deck</button>
          ${m.find(c=>c.id===e.id)?`<button onclick="removeFromCollection('${e.id}')">Delete from Collection</button>`:""}
        </div>
        <button onclick="closeInfoBox()" style="margin-top:14px;">Close</button>
      </div>
    </div>
  `,document.body.appendChild(v),setTimeout(()=>{n.classList.add("show"),v.classList.add("show")},10)}function $(){document.querySelectorAll(".info-box, .info-overlay").forEach(e=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)})}function G(e,n,i,s){$();const t=k(),a=Object.keys(t);if(a.length===0){alert("No decks available. Please create a deck first.");return}document.querySelectorAll(".overlay, .deck-selection-box").forEach(d=>d.remove());const o=document.createElement("div");o.classList.add("overlay"),o.addEventListener("click",M),document.body.appendChild(o);const l=document.createElement("div");l.classList.add("deck-selection-box"),l.innerHTML=`
    <h4>Select a Deck</h4>
    ${a.map(d=>`<button onclick="addToDeck('${d}', { id: '${e}', name: '${n}', image: '${i}', setName: '${s}' })">${d}</button>`).join("")}
    <button onclick="closeDeckSelection()">Cancel</button>
  `,document.body.appendChild(l),setTimeout(()=>{o.classList.add("show"),l.classList.add("show")},10)}function M(){document.querySelectorAll(".overlay, .deck-selection-box").forEach(e=>{e.classList.remove("show"),setTimeout(()=>e.remove(),300)})}document.getElementById("saveCollection").addEventListener("click",()=>{localStorage.setItem("collection",JSON.stringify(m)),alert("Collection saved!")});const A=document.getElementById("createDeckForm");A&&A.addEventListener("submit",e=>{e.preventDefault();const n=document.getElementById("deckName").value.trim();R(n),document.getElementById("deckName").value=""});document.addEventListener("DOMContentLoaded",()=>{u(),h()});document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".tab-button").forEach(s=>s.classList.remove("active")),e.classList.add("active"),document.querySelectorAll(".tab-content.active").forEach(s=>{s.classList.remove("active"),setTimeout(()=>{s.style.display="none"},400)});const n=e.getAttribute("data-tab"),i=document.getElementById(n);if(i&&(i.style.display="block",i.offsetWidth,i.classList.add("active")),n==="collection")typeof u=="function"&&u();else if(n==="decks")typeof h=="function"&&h();else{const s=document.getElementById("collectionContent");s&&(s.innerHTML="")}})});document.addEventListener("DOMContentLoaded",()=>{var n;const e=localStorage.getItem("apiKey");e&&(document.getElementById("apiKey").value=e),(n=document.querySelector(".tab-button.active"))==null||n.click()});document.getElementById("settingsForm").addEventListener("submit",e=>{e.preventDefault();const n=document.getElementById("apiKey").value.trim();n&&(localStorage.setItem("apiKey",n),document.getElementById("settingsMessage").textContent="Settings saved successfully!",setTimeout(()=>{document.getElementById("settingsMessage").textContent=""},3e3))});window.addToCollection=j;window.removeFromCollection=P;window.showDeckSelection=G;window.closeInfoBox=$;window.addToDeck=K;window.closeDeckSelection=M;window.removeFromDeck=J;window.deleteDeck=T;window.renderDeckList=h;
